<!DOCTYPE HTML>
<html>

<head>
	<title>Html5 File Upload + Nginx</title>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
	
</head>

<body>
	
	<form method="post" enctype="multipart/form-data" >
		<input type="file" name="upload" multiple class="input_file" />
		
		<button class="btn_upload" type="button" >Upload</button>
	</form>
	
<script>
(function(){
	"use strict";
	
	$(".input_file").on('change', function (){ 
		handleMultiFileSelect.apply(this, arguments) 
	});
	$('.btn_upload').on('click', function (){ 
		upload.apply(this, arguments) 
	});
	
	var uploads = [];
	
	var handleMultiFileSelect = function(obj) {
		var files
		if(obj.target) {
			files = obj.target.files;
		} else {
			files = obj;
		}

		for ( var i = 0; i < files.length; i++) {
			var file = files[i];
			
			uploads.push(file);
		}
	}
		
	// use this transport for "binary" data type
	$.ajaxTransport("+binary", function(options, originalOptions, jqXHR){
		// check for conditions and support for blob / arraybuffer response type
		if (window.FormData && ((options.dataType && (options.dataType == 'binary')) 
		|| (options.data && ((window.ArrayBuffer && options.data instanceof ArrayBuffer) 
		|| (window.Blob && options.data instanceof Blob)))))
		{
			return {
				// create new XMLHttpRequest
				send: function(headers, callback){
					// setup all variables
					var xhr = new XMLHttpRequest(),
					url = options.url,
					type = options.type,
					async = options.async || true,
					// blob or arraybuffer. Default is blob
					dataType = options.responseType || "blob",
					data = options.data || null,
					username = options.username || null,
					password = options.password || null;
								
					xhr.addEventListener('load', function(){
						var data = {};
						data[options.dataType] = xhr.response;
						// make callback and send data
						callback(xhr.status, xhr.statusText, data, xhr.getAllResponseHeaders());
					});
					
					xhr.open(type, url, async, username, password);
							
					// setup custom headers
					for (var i in headers ) {
						xhr.setRequestHeader(i, headers[i] );
					}
							
					xhr.responseType = dataType;
					xhr.send(data);
				},
				abort: function(){
					jqXHR.abort();
				}
			};
		}
	});
	
	function upload(){
		var data = new FormData();
		var file = uploads[0];
		// one file only test
		data.append('upload', uploads[0] );
					
		$.ajax({
			url: "/upload",
			data: file,
			cache: false,
			contentType: file.type,
			processData: false,
			type: 'POST',
			dataType: "json",
			success: function(data){
				console.log(data);
			}
		});
	}
	
})();
</script>
</body>

</html>